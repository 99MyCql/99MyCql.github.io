<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/golang32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/golang16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-RpvRDWfflk">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.dounine.live","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="[TOC] 0. 前言综合第4章与第5章的网络层，以及课上老师所讲内容，与书本有较大不同。 在上一章中，曾提到运输层解决了进程间的通信问题。那么，网络层则解决了主机间的通信问题。 在偌大的互联网上，网络层会选择一条最短路径，将源主机的数据，经过一步步的转发，交付给目的主机。 而这个过程，就像现在的物流寄件，我们要如何将一份邮件或物品从发件地址邮寄到收件地址。">
<meta property="og:type" content="article">
<meta property="og:title" content="《计算机网络》笔记-第4&#x2F;5章网络层">
<meta property="og:url" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82.html">
<meta property="og:site_name" content="dounine&#39;s blog">
<meta property="og:description" content="[TOC] 0. 前言综合第4章与第5章的网络层，以及课上老师所讲内容，与书本有较大不同。 在上一章中，曾提到运输层解决了进程间的通信问题。那么，网络层则解决了主机间的通信问题。 在偌大的互联网上，网络层会选择一条最短路径，将源主机的数据，经过一步步的转发，交付给目的主机。 而这个过程，就像现在的物流寄件，我们要如何将一份邮件或物品从发件地址邮寄到收件地址。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/5.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/4.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/6.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/7.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/8.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/10.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/9.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/11.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/12.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/13.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/14.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/1.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/2.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/3.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/15.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/16.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/19.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/17.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/18.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/20.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/21.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/22.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/23.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/24.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/25.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/31.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/32.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/26.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/27.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/29.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/28.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/30.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/33.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/34.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/35.png">
<meta property="og:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/36.png">
<meta property="article:published_time" content="2020-06-18T12:58:25.000Z">
<meta property="article:modified_time" content="2020-06-18T12:58:25.000Z">
<meta property="article:author" content="dounine">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/5.png">


<link rel="canonical" href="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82.html","path":"《计算机网络》笔记-第4-5章网络层.html","title":"《计算机网络》笔记-第4/5章网络层"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《计算机网络》笔记-第4/5章网络层 | dounine's blog</title>
  
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZN5WSXHZY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-SZN5WSXHZY');
    </script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-SZN5WSXHZY","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?66c7065aa71681df47eb23eff557978b"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">dounine's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">18</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">50</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">84</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-%E5%89%8D%E8%A8%80"><span class="nav-text">0. 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="nav-text">1. 网络层概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE-IP-%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3"><span class="nav-text">2. 网际协议 IP 及其相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-IPv4-%E7%BC%96%E5%9D%80"><span class="nav-text">2.1. IPv4 编址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E6%8E%A5%E5%8F%A3"><span class="nav-text">2.1.1. 接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E7%82%B9%E5%88%86%E5%8D%81%E8%BF%9B%E5%88%B6%E8%AE%B0%E6%B3%95"><span class="nav-text">2.1.2. 点分十进制记法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%88%92%E5%88%86%E7%BD%91%E7%BB%9C"><span class="nav-text">2.2. 划分网络</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%88%86%E7%B1%BB%E7%9A%84-IP-%E5%9C%B0%E5%9D%80"><span class="nav-text">2.2.1. 分类的 IP 地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91"><span class="nav-text">2.2.2. 划分子网</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80-CIDR"><span class="nav-text">2.2.3. 无分类编址 CIDR</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-IPv4-%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-text">2.3. IPv4 数据报格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-IPv4-%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%88%86%E7%89%87"><span class="nav-text">2.4. IPv4 数据报分片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-DHCP"><span class="nav-text">2.5. DHCP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-NAT"><span class="nav-text">2.6. NAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-VPN"><span class="nav-text">2.7. VPN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-IPv6"><span class="nav-text">2.8. IPv6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-ICMP"><span class="nav-text">2.9. ICMP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%93%E6%9E%84%E4%B8%8E%E8%BD%AC%E5%8F%91"><span class="nav-text">3. 路由器结构与转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">4. 路由选择算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">4.1. 链路状态路由选择算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">4.2. 距离向量路由选择算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-LS-%E4%B8%8E-DV-%E7%9A%84%E6%AF%94%E8%BE%83%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="nav-text">4.3. LS 与 DV 的比较与应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E5%86%85%E9%83%A8%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%EF%BC%9AOSPF"><span class="nav-text">4.4. 自治系统内部的路由选择：OSPF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E9%97%B4%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%EF%BC%9ABGP"><span class="nav-text">4.5. 自治系统间的路由选择：BGP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-AS-%E5%86%85%E9%83%A8%E5%92%8C-AS-%E9%97%B4%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-text">4.6. AS 内部和 AS 间路由选择协议的比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C-SDN"><span class="nav-text">5. 软件定义网络 SDN</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dounine"
      src="https://avatars.githubusercontent.com/u/41814469?s=400&u=48bf60a3428a3cb86a84a110c8688930cf6ceb08&v=4">
  <p class="site-author-name" itemprop="name">dounine</p>
  <div class="site-description" itemprop="description">回首向来萧瑟处</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/99MyCql" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;99MyCql" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://bkfish.gitee.io/" title="https:&#x2F;&#x2F;bkfish.gitee.io&#x2F;" rel="noopener" target="_blank">bkfish</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://hitworld.github.io/" title="https:&#x2F;&#x2F;hitworld.github.io&#x2F;" rel="noopener" target="_blank">w4rd3n</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://wyjoutstanding.github.io/" title="https:&#x2F;&#x2F;wyjoutstanding.github.io&#x2F;" rel="noopener" target="_blank">wyjoutstanding</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://iwtf.github.io/" title="https:&#x2F;&#x2F;iwtf.github.io&#x2F;" rel="noopener" target="_blank">IWTF</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://wood1314.github.io/" title="https:&#x2F;&#x2F;wood1314.github.io&#x2F;" rel="noopener" target="_blank">wood</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://desperadoccy.xyz/" title="https:&#x2F;&#x2F;desperadoccy.xyz&#x2F;" rel="noopener" target="_blank">desperadoccy</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://doudouqaq.github.io/" title="https:&#x2F;&#x2F;doudouqaq.github.io&#x2F;" rel="noopener" target="_blank">doudouqaq</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kylinnnnn.github.io/" title="https:&#x2F;&#x2F;kylinnnnn.github.io&#x2F;" rel="noopener" target="_blank">kylinnnnn</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://miaotony.xyz/" title="https:&#x2F;&#x2F;miaotony.xyz" rel="noopener" target="_blank">miaotony</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://110.40.153.120:3030/" title="http:&#x2F;&#x2F;110.40.153.120:3030&#x2F;" rel="noopener" target="_blank">AZhou</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/weixin_40986490" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_40986490" rel="noopener" target="_blank">白速龙王的回眸</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/weixin_43116322" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_43116322" rel="noopener" target="_blank">Ethan</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dounine.live/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/41814469?s=400&u=48bf60a3428a3cb86a84a110c8688930cf6ceb08&v=4">
      <meta itemprop="name" content="dounine">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dounine's blog">
      <meta itemprop="description" content="回首向来萧瑟处">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《计算机网络》笔记-第4/5章网络层 | dounine's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《计算机网络》笔记-第4/5章网络层
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-18 20:58:25" itemprop="dateCreated datePublished" datetime="2020-06-18T20:58:25+08:00">2020-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Base/" itemprop="url" rel="index"><span itemprop="name">九层之台，起于累土</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Base/Network/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>[TOC]</p>
<h2 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h2><p>综合第4章与第5章的网络层，以及课上老师所讲内容，与书本有较大不同。</p>
<p>在上一章中，曾提到运输层解决了进程间的通信问题。那么，网络层则解决了<strong>主机间的通信问题</strong>。</p>
<p>在偌大的互联网上，网络层会选择一条最短路径，将源主机的数据，经过一步步的转发，交付给目的主机。</p>
<p>而这个过程，就像现在的<strong>物流寄件</strong>，我们要如何将一份邮件或物品从发件地址邮寄到收件地址。</p>
<span id="more"></span>

<h2 id="1-网络层概述"><a href="#1-网络层概述" class="headerlink" title="1. 网络层概述"></a>1. 网络层概述</h2><p>网络层的主要协议为：<strong>IP协议</strong>。</p>
<p>网络层传输单元为：<strong>数据报</strong>。</p>
<p>网络层主要有两种功能：</p>
<ul>
<li><strong>转发</strong>：<ul>
<li>属于<strong>网络层数据平面</strong>。</li>
<li>将分组从一个数据报从输入链路转发到输出链路，由路由器完成，时间尺度短，通常用硬件实现。</li>
<li>类似于通过一个物流站点。</li>
<li>传统的方法：<strong>基于目的地转发</strong>（IP转发）；现代的方法：通用转发。</li>
</ul>
</li>
<li><strong>路由选择</strong>：<ul>
<li>属于<strong>网络层控制平面</strong>。</li>
<li>决定端到端的路径，时间尺度长，通常用软件实现。</li>
<li>类似于邮件从深圳到北京的行程规划。</li>
<li>传统的方法：<strong>路由选择算法</strong>；现代的方法：SDN（软件定义网络）。</li>
</ul>
</li>
</ul>
<h2 id="2-网际协议-IP-及其相关"><a href="#2-网际协议-IP-及其相关" class="headerlink" title="2. 网际协议 IP 及其相关"></a>2. 网际协议 IP 及其相关</h2><p>在进行转发和路由选择之前，我们必须解决一个重要问题：<strong>如何标识一台主机？</strong></p>
<p>主机的标识就像<strong>邮寄单上的收件地址</strong>一样。只有当每个主机的标识唯一时，才能将数据准确地交付到目的地。</p>
<p>而这，就是IP协议中IP地址的作用。</p>
<h3 id="2-1-IPv4-编址"><a href="#2-1-IPv4-编址" class="headerlink" title="2.1. IPv4 编址"></a>2.1. IPv4 编址</h3><h4 id="2-1-1-接口"><a href="#2-1-1-接口" class="headerlink" title="2.1.1. 接口"></a>2.1.1. 接口</h4><p>主机与物理链路之间的边界叫做<strong>网络接口（Interface，也叫网卡）</strong>。</p>
<p>主机通常只有一个网络接口（也可能是两个：有线网接口和无线网接口）；而路由器由于是不同网络间的交接中心，所以路由器至少需要与两条网络链路相连，因此路由器拥有多个网络接口。</p>
<p><strong>从技术上讲，一个IP地址与一个网络接口（网卡）相关联，而不是主机或路由器（可能是方便网络管理）</strong>。比如：路由器通常有内网接口和公网接口，而内网接口和公网接口的IP地址是不相同的。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/5.png" alt="pic"></p>
<h4 id="2-1-2-点分十进制记法"><a href="#2-1-2-点分十进制记法" class="headerlink" title="2.1.2. 点分十进制记法"></a>2.1.2. 点分十进制记法</h4><p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/4.png" alt="pic"></p>
<h3 id="2-2-划分网络"><a href="#2-2-划分网络" class="headerlink" title="2.2. 划分网络"></a>2.2. 划分网络</h3><p>为了方便IP地址分类管理，我们通常将一定数量的主机组成一个<strong>子网 &#x2F; 网络</strong>。</p>
<p>其好处是：</p>
<ul>
<li><p><strong>方便子网内部管理</strong>。每个子网可以自由决定所使用的链路层网络、路由算法等。</p>
</li>
<li><p>网络一般通过一个路由器与其它网络相连，当路由器要转发IP数据报时，只要将数据报转发到所属的网络即可，再由所属的网络进行分发，<strong>使得路由器的转发工作更加简单</strong>。我们可以类比 <strong>邮编地址</strong>：南京市每个区都有特定的邮编地址，组成起来，就是南京市邮编地址的“网络”。<strong>若要转发 目的地为南京市江宁区 的邮件，我们可以先将它转发给南京市，再由南京市内部进行分发</strong>。</p>
</li>
</ul>
<p>那么如何来划分网络呢？从古至今，经过了三步发展：</p>
<ul>
<li><strong>分类的 IP 地址</strong>。</li>
<li><strong>子网的划分</strong>。</li>
<li><strong>无分类编址方法 CIDR</strong>。</li>
</ul>
<h4 id="2-2-1-分类的-IP-地址"><a href="#2-2-1-分类的-IP-地址" class="headerlink" title="2.2.1. 分类的 IP 地址"></a>2.2.1. 分类的 IP 地址</h4><p>将IP地址划分为<strong>网络号</strong>和<strong>主机号</strong>。网络号用于标识网络，主机号用于标识网络中的主机。</p>
<p>如果两个IP地址的网络号部分相同，则说明它们都属于同一个网络。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/6.png" alt="pic"></p>
<p>总共有 A、B、C、D、E 五种分类方法。A 类常用于大型网络，B 类常用于中型，C 类则用于小型，D、E 类特殊用途。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/7.png" alt="pic"><br><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/8.png" alt="pic"></p>
<p>注：网络号不能全为0，所以A类网络的网络数需要减多一个 1 ；主机号不能全为0，也不能全为1，所以C类网络中主机数为 $2^8-2 &#x3D; 254$。</p>
<p>以下是分类 IP 地址的一些示例：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/10.png" alt="pic"></p>
<h4 id="2-2-2-划分子网"><a href="#2-2-2-划分子网" class="headerlink" title="2.2.2. 划分子网"></a>2.2.2. 划分子网</h4><p>由于分类的 IP 地址中，某类网络所拥有的主机数是固定的，所以有时候会觉得C类地址中主机数太少，有时候又会觉得B类地址中主机数太多。</p>
<p>为此，又提出从主机号中划分出子网号，使得两级 IP 地址变成了三级 IP 地址。而且，子网号的长度是可变的：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/9.png" alt="pic"></p>
<p>但新的问题出现了，由于子网号可变，那如何从一个IP地址中区分出子网号呢？</p>
<p><strong>子网掩码！子网掩码长度为32位，左边连续且全为 1 的部分对应网络号和子网号，右边连续且全为 0 的部分对应主机号</strong>。当用子网掩码与 IP 地址进行 <strong>与运算</strong> 后，便可以得到子网号。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/11.png" alt="pic"></p>
<p>另外，子网掩码是由子网提供的，并会记录在路由器的路由表中：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/12.png" alt="pic"></p>
<h4 id="2-2-3-无分类编址-CIDR"><a href="#2-2-3-无分类编址-CIDR" class="headerlink" title="2.2.3. 无分类编址 CIDR"></a>2.2.3. 无分类编址 CIDR</h4><p>随着时代的发展，人们发现了更好的 <strong>无分类域间路由选择 CIDR</strong> 方法。</p>
<ul>
<li>它消除了传统的A、B、C类地址和划分子网的概念；</li>
<li>采用变长的子网掩码，可以灵活地分配网络号；</li>
<li>并且网络可以进行嵌套；</li>
<li>IP 地址也从三级编址回到了两级编址。</li>
</ul>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/13.png" alt="pic"></p>
<p>补充说明：</p>
<ul>
<li>CIDR 中，<strong>网络前缀</strong>相当于此前的网络号，只是现在的网络号是变长的；</li>
<li>CIDR 采用 <strong>a.b.c.d&#x2F;x</strong> 的记法来表示 IP 地址，斜杠 <code>/</code> 之后的 <code>x</code> 表示子网掩码中 1 的个数，用来指明网络前缀的长度。</li>
</ul>
<p>CIDR 实践：</p>
<ul>
<li><strong>路由聚合（route aggregation）</strong>。如下图，<code>Fly-By-Night-ISP</code> 内部有 8 个自组织，每个组织都有自己的子网。通过 CIDR 编址，外界只需要将所有 IP 地址前 20 比特与 <code>200.23.16.0/20</code> 相符的数据报，发送到该 ISP 即可，而不需要知道该 ISP 内还存在 8 个其它组织。</li>
</ul>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/14.png" alt="pic"></p>
<ul>
<li><strong>最长前缀匹配</strong>。使用 CIDR 时，路由器路由表的每一项由网络前缀和对应的输出链路组成。当根据 IP 地址查找路由表时，可能会匹配多个网络前缀，则应当从匹配结果中选出最长的网络前缀。</li>
</ul>
<h3 id="2-3-IPv4-数据报格式"><a href="#2-3-IPv4-数据报格式" class="headerlink" title="2.3. IPv4 数据报格式"></a>2.3. IPv4 数据报格式</h3><p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/1.png" alt="pic"></p>
<ul>
<li>版本：IP协议版本。</li>
<li>首部长度：大多数IP数据报的首部不包含可变部分，所以<strong>一般的IP数据报首部长度为20字节</strong>。</li>
<li>服务类型（区分服务）：将用于不同服务的IP数据报区分开来。例如，将实时数据报（IP电话应用）和非实时数据报（FTP）区分。</li>
<li>数据报长度（总长度）：整个IP数据报长度，以字节为单位。16位，理论上最大长度为65535字节，但受限于链路层最大帧长度MTU，<strong>一般不超过1500字节</strong>。</li>
<li>标识、标志、片偏移：这三个字段与<strong>IP分片</strong>有关，将马上讨论。</li>
<li><strong>寿命（TTL，生存时间）</strong>：用来保证数据报不会永远在网络中死循环，每经过一台路由器时，该字段的值减1，若减为0，则该数据报必须丢弃。</li>
<li>协议：指定交给哪个<strong>运输层协议</strong>。</li>
<li>首部校验和：用于检测数据报首部是否出现比特差错。</li>
<li><strong>源和目的IP地址</strong>：用于标识源主机IP，和目的主机IP。</li>
<li>可变部分：通常没被使用。</li>
<li>数据：可以是要交付给目的地的运输层报文段，也可以是其它类型数据，比如ICMP报文。</li>
</ul>
<h3 id="2-4-IPv4-数据报分片"><a href="#2-4-IPv4-数据报分片" class="headerlink" title="2.4. IPv4 数据报分片"></a>2.4. IPv4 数据报分片</h3><p>受限于 <strong>链路层最大帧长度 MTU</strong> 影响（以太网帧不能超过1500字节、某些广域网链路不能超过576字节），IP 数据报过大时，需要对 IP 数据报进行分片：将原数据报中的数据部分分成恰好的几部分，对每一部分数据都加上 IP 首部，组成几个新的 IP 数据报。</p>
<p>IP 数据报分片依托于首部的<strong>标识</strong>、<strong>标志</strong>、<strong>片偏移</strong>字段：</p>
<ul>
<li><strong>标识</strong>：产生 IP 数据报的标识，用于区分不同的分片数据报，是属于哪个原始数据报。</li>
<li><strong>标志</strong>：3字节，目前只有后两位有意义，最低位是**MF(More Fragment)<strong>，中间位是</strong>DF(Don’t Fragment)**。<code>MF = 1</code> 表示后面还有分片，<code>MF = 0</code> 表示最后一个分片，<code>DF = 0</code> 表示允许分片。</li>
<li><strong>片偏移</strong>：表示这个分片在原始数据报中的位置，以8字节为单位。</li>
</ul>
<p>示例：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/2.png" alt="pic"><br><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/3.png" alt="pic"></p>
<p><strong>注意：在第3章中提到，TCP为了防止IP分片，会先一步进行分段。</strong></p>
<h3 id="2-5-DHCP"><a href="#2-5-DHCP" class="headerlink" title="2.5. DHCP"></a>2.5. DHCP</h3><p>我们知道，划分网络是为了各种各样的组织更好地管理网络。当某个组织（比如学校、公司等）申请入网后，相关机构会给组织分配一个子网络（也就是一系列IP地址），组织可以自由地分配这一些列IP地址。</p>
<p>从前，这项工作通常由组织的管理员手动为每台主机和路由器配置。但如今，更多的是使用 <strong>动态主机配置协议（Dynamic Host Configuration Protocol，DHCP）</strong> 来完成：</p>
<ul>
<li>DHCP 允许主机自动获取IP地址；</li>
<li>可以通过配置，使得同一台主机每次联网时，既能得到一个相同的IP地址，也可以被分配到一个临时的IP地址；</li>
<li>除了主机IP地址分配外，DHCP还会告知主机 子网掩码、默认网关、默认DNS 等信息。</li>
</ul>
<p>它也常常被称为<strong>即插即用协议</strong>或<strong>零配置协议</strong>。</p>
<p>DHCP 为联网主机分配IP地址的过程为：</p>
<ol>
<li><p><strong>DHCP 服务器发现</strong>：一台刚联网的主机，会向网络中发送一个 <strong>DHCP 发现报文（DHCP discover message）</strong>，这是一个由 67 号端口发送的 UDP 报文。该报文的 <strong>目的地址</strong> 为 <strong>255.255.255.255（IP 地址全 1 表示广播地址，会发送给当前子网络中的所有主机）</strong>，<strong>源地址</strong> 为 <strong>0.0.0.0（主机还不知道它的地址）</strong> 。</p>
</li>
<li><p><strong>DHCP 服务器提供</strong>：网络中的 DHCP 服务器收到一个 DHCP 发现报文后，会用 <strong>DHCP 提供报文（DHCP offer message）</strong> 进行响应。报文的目的地址依然是 <strong>255.255.255.255</strong>，但同时报文中包含对应 DHCP 发现报文的事务ID、向用户推荐的IP地址、网络掩码和IP地址有效期等。</p>
</li>
<li><p><strong>DHCP 请求</strong>：由于一个网络中可能存在多个 DHCP 服务器，用户会从多个 DHCP 提供报文中选择一个，并发送 <strong>DHCP 请求报文（DHCP request message）</strong> 响应对应的 DHCP 服务器（你就天选之子&gt;.&lt;）。</p>
</li>
<li><p><strong>DHCP ACK</strong>：DHCP 服务会对 DHCP 请求报文进行响应。</p>
</li>
</ol>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/15.png" alt="pic"></p>
<h3 id="2-6-NAT"><a href="#2-6-NAT" class="headerlink" title="2.6. NAT"></a>2.6. NAT</h3><p>从前面的介绍中，我们知道：<strong>每个联网设备都会分配一个唯一的IP地址</strong>。但是，随着互联网的爆发，入网设备激增，剩余 IP 地址越来越少。</p>
<p>同时，越来越多的小型子网（家庭网络、小型办公室）涌现。如果这些子网想要联网，ISP 则需要分配一组地址给该子网的所有联网设备。如果某天这个子网变大了，ISP 可能得分配一块较大的连续地址，但这组地址后的连续地址都被占有了，这该怎么办呢？ISP 管理这些子网显得十分繁琐。而且，家庭的主人还需要知道 IP 地址管理经典方法。</p>
<p>幸运的是，一个简单的方法被用来解决这个问题，那就是 <strong>网络地址转换（Network Address Translation, NAT）</strong> ——它将这些子网指定为专用网络，专用网络中可以自主分配专用地址。</p>
<p>在介绍 NAT 之前，不知道细心的同学们有没有发现一个现象：不管你电脑连接的是家庭网络、学校网络、还是手机热点，电脑的 IP 地址经常都是 <code>192.168.x.x</code> ，甚至有时候还是相同的。</p>
<p>为什么会这么巧呢？这就是 NAT 在背后作祟。</p>
<p>以家庭网络为例：</p>
<ul>
<li>每个家庭都会有至少一个路由器，与路由器相连的家庭设备都处于<strong>同一个子网</strong>中，这个子网就是私有网络（也可以称作<strong>内网&#x2F;LAN</strong>）。</li>
<li>而路由器另一端所连接的互联网，通常称为<strong>公网&#x2F;WAN</strong>。</li>
<li>因此，路由器拥有两个 IP 地址（一个网络接口对应一个 IP 地址），内网 IP 和公网 IP 。</li>
<li>NAT 则被设置在这台路由器上。当内网设备访问公网的数据报经过这台 NAT 路由器时，<strong>NAT 路由器会将数据报中的源 IP 地址改成自己的公网 IP 地址，以及将源端口号更改为自己的端口号</strong>，并把映射关系记录在 <strong>NAT 转换表</strong> 上。</li>
<li>当收到公网的响应数据报时，NAT 路由器会<strong>从 NAT 转换表上找映射关系</strong>，这次则<strong>将数据报中的目的 IP 地址和目的端口号，改为对应内网主机的 IP 地址和端口号</strong>。</li>
</ul>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/16.png" alt="pic"></p>
<p>在外界看来，NAT 路由器就像一个具有单一 IP 地址的单一设备，它<strong>隐藏了家庭网络的细节</strong>。所有离开家庭网络流向公网的报文都拥有同一个源 IP 地址，而所有进入家庭网络的报文都拥有同一个目的 IP 地址。</p>
<p>凭借着 NAT 协议，N 个主机可以拥有任意内网 IP ，而在外界看来就只有一个公网 IP 地址（由于端口号字段为 16 比特，所以 <strong>NAT 路由器可支持超过 60000 个的连接</strong>）。如此往后，ISP 再也不用操心子网 IP 地址分配的问题，家庭子网的主人也不需要掌握管理子网的方法了，这都可以由家庭路由器统一自动分配管理。</p>
<p>虽然 NAT 既简单又好用，但也存在着几个问题：</p>
<ol>
<li><strong>内网 IP 与公网 IP 冲突问题</strong>。</li>
</ol>
<p>  由于内网中所有的 IP 地址经过 NAT 路由器后，都会变成 NAT 路由器的公网 IP 地址，所以内网中的 IP 地址可以任意分配。但是，如果一个 IP 地址即存在于内网又存在于公网，NAT 路由器要如何转发呢？</p>
<p>  为了避免这个矛盾的出现，**互联网规定三类 IP 地址块（地址范围）为专用地址，只能用于专用网络（也就是内网）不能出现在公网上，分别是：<code>10.0.0.0 ~ 10.255.255.255</code>、<code>172.16.0.0 ~ 172.31.255.255</code>、<code>192.168.0.0 ~ 192.168.255.255</code>**（所以，我们经常见到电脑的 IP 地址为 <code>192.168.x.x</code> ，其实这就是一个内网 IP ）。</p>
<ol start="2">
<li><strong>内网IP无法被外部主机访问</strong>。</li>
</ol>
<p>  由于 NAT 路由器把内网隐藏了，而且内网 IP 也不会出现在公网上。<strong>如果一台主机想要被外部主机访问，则需要申请公网 IP</strong>，而这只能向相关运营商购买。如果实在想访问内网主机，可以采用<strong>内网穿透</strong>等方法。</p>
<ol start="3">
<li><strong>路由器作为网络层设备，却修改应用层的端口号，不符合体系结构</strong>。</li>
</ol>
<p>  但随着 NAT 的流行，这种反对的声音也渐渐变小。</p>
<h3 id="2-7-VPN"><a href="#2-7-VPN" class="headerlink" title="2.7. VPN"></a>2.7. VPN</h3><p>上文提到，NAT 协议能够方便地管理专用网络，但其中一个问题就是专用网络（内网）中的主机是不可访问的。有些机构在使用 NAT 的同时，又想从外部访问内网的主机，那要怎么办呢？</p>
<p>申请公网 IP ？但问题是，机构申请到的公网 IP 数量往往是有限；而且由于互联网的不安全性，一个机构也不想把部分主机接入互联网。</p>
<p>为了解决从外部网络访问内网主机的问题，<strong>虚拟专用网络（Virtual Private Network，VPN）</strong> 被提出来了。说到 VPN ，很多老司机们应该再清楚不过了:) <strong>科学上网</strong>的必备工具，此刻我们就来见识一下 VPN 奥妙。</p>
<p>VPN 可以将相隔着公网的两个专用网络连接起来，就好像一个专用网络一样（实际上并不是），所以称为虚拟专用网络。那它是如何实现的呢？</p>
<ul>
<li><p>首先，购买 VPN 的机构，必须在通信的两端进行相关配置，相互之间必须知道对方的地址。</p>
</li>
<li><p>其次，专用网络之间的通信必须经过公网，为了保密要求，VPN 还必须对所有传输的数据进行加密。</p>
</li>
<li><p>最后，利用 <strong>隧道</strong> 技术进行传输。隧道技术其实就一个<strong>包装、拆包</strong>的过程：内网 A 中主机 X 发送给内网 B 中主机 Y 的数据报，到达出口路由器后，会将数据报进行加密，并<strong>再套上一个 IP 首部</strong>，以内网 B 中入口路由器的公网 IP 地址为目的地址；到达内网 B 的入口路由器后，会取出<strong>数据部分</strong>进行解密，并转发到内网，最终到达主机 Y 。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/19.png" alt="pic"></p>
</li>
</ul>
<h3 id="2-8-IPv6"><a href="#2-8-IPv6" class="headerlink" title="2.8. IPv6"></a>2.8. IPv6</h3><p>虽然 NAT 一定程度上也扩充了互联网中联网设备的容量，但公网 IP 的数量还是受 IPv4 地址的限制，IPv4 地址只有 32 位，总共才 $4,294,967,295 \approx 4.2 \times 10^9 \approx 42亿$ 个。随着互联网惊人的增长，公网 IP 也即将耗尽。</p>
<p>为了避免耗尽情况的出现，一种新的 IP 协议被提出——IPv6。</p>
<p><strong>IPv6 将 IP 地址长度从 32 比特增加到了 128 比特</strong>。现在，地球上的每个沙砾都可以用 IP 地址寻址了。</p>
<p><strong>IPv6 数据报格式</strong>如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/17.png" alt="pic"></p>
<p>其最重要的几大<strong>新增改变</strong>如下：</p>
<ul>
<li>首先，<strong>扩大的地址容量</strong>，IP 地址从32位比特增加到128比特。</li>
<li>其次，<strong>首部简化为40字节</strong>。</li>
<li>同时，提供<strong>流</strong>服务，流是提供某些特殊服务所使用的，比如音频视频等。</li>
</ul>
<p>但几个 IPv4 中的字段和功能在 IPv6 数据报中也<strong>不复存在</strong>了：</p>
<ul>
<li><strong>取消分片</strong>。IPv6 不允许在中间路由器上进行分片与重新组装，这种操作只能在源和目的地执行。如果路由器收到的 IPv6 数据报因太大而不能转发到输出链路上的话，路由器会丢弃该数据报，并向发送方发送一个“分组太大”的 ICMP 差错报文。于是，发送方将使用较小长度的 IP 数据报重发。</li>
<li><strong>删除首部校验和字段</strong>。由于运输层和数据链路层协议中都包含了校验操作，所以 IP 设计者觉得网络层再具有该功能实属多余。</li>
<li><strong>删除选项字段</strong>。IPv6 首部中，选项字段已经不复存在了。但它并没有消失，而是可能出现在 IPv6 首部的“下一个首部”字段所指出的位置上。当然，通常情况下，“下一个首部”字段指的是 TCP 或 UDP 首部。</li>
</ul>
<p>虽然 IPv6 被设计出来，但已部署 IPv4 的系统却不能够处理 IPv6 数据报，如何从 IPv4 迁移到 IPv6 是当下的大问题。</p>
<p>其中一个迁移方法便是 <strong>建隧道（tunneling）</strong>：</p>
<p>假设两个 IPv6 节点使用 IPv6 数据报进行交互，中间经过 IPv4 路由器，那么我们可以把中间 IPv4 路由器的集合称为一个 <strong>隧道</strong>。当 IPv6 数据报要进入隧道时，可以用 IPv4 数据报<strong>包裹</strong>起来，出隧道时，再取出。其过程如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/18.png" alt="pic"></p>
<h3 id="2-9-ICMP"><a href="#2-9-ICMP" class="headerlink" title="2.9. ICMP"></a>2.9. ICMP</h3><p>在上文中提到，ICMP 报文可以被 IPv6 用来告知发送方数据报过大，但ICMP的作用不止于此。</p>
<p>**因特网控制报文协议 ICMP [RFC 792]**，被主机和路由器用来彼此沟通网络层信息的协议。</p>
<p>其报文格式如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/20.png" alt="pic"></p>
<p>由图可知，ICMP 报文类似于 TCP、UDP ，它也是被 IP 数据报所包裹的。</p>
<p>根据首部<strong>类型</strong>字段和<strong>代码</strong>字段的不同，ICMP 报文有着不同的功能，常见的如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/21.png" alt="pic"></p>
<p>ICMP 最贴近我们的应用，便是 <strong>ping</strong> 程序和 <strong>Traceroute</strong> 程序了。众所周知的 ping 程序便是发送一个类型 8 编码 0 的 ICMP 报文，目的主机返回一个类型 0 编码 0 的 ICMP 响应报文。</p>
<p>Windows 下实验 traceroute，打开 cmd ，输入指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; tracert baidu.com</span><br></pre></td></tr></table></figure>

<h2 id="3-路由器结构与转发"><a href="#3-路由器结构与转发" class="headerlink" title="3. 路由器结构与转发"></a>3. 路由器结构与转发</h2><p>路由器是网络层中重要的设备。它用于<strong>连接不同的网络</strong>，并在不同网络间<strong>转发分组</strong>，同时也具备<strong>路由选择</strong>的功能。</p>
<p>路由器结构如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/22.png" alt="pic"></p>
<ul>
<li><p><strong>输入端口</strong>。输入端口包含物理层、链路层、网络层处理模块。物理层模块负责接收处理物理信号；链路层模块负责去掉帧首部和尾部；网络层模块负责进行查表、转发、排队进入交换结构。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/23.png" alt="pic"></p>
<p>其中，<strong>查表和转发</strong>是输入端口的核心功能。</p>
<ul>
<li>以传统的<strong>基于目的地转发</strong>为例：查表主要是根据分组目的地址的<strong>前缀</strong>，在<strong>转发表</strong>（由路由选择处理器提供，可以看作路由表）中查找匹配项（此处会用到前面提到的<strong>最长前缀匹配规则</strong>）；转发则是根据查表结果，将分组送入交换结构中，转发到对应输出链路；如果交换结构正繁忙，分组还需要排队等候。</li>
<li>而更高级的<strong>通用转发</strong>，则采用“匹配加动作”的抽象方式。</li>
</ul>
</li>
<li><p><strong>交换结构</strong>。经过交换结构，分组才能从一个输入端口交换到一个输出端口。交换结构可以用多种形式，分别是 经内存交换、经总线交换、经互联网络交换（纵横式），如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/24.png" alt="pic"></p>
</li>
<li><p><strong>输出端口</strong>。将队列中的分组发送到输出链路上。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/25.png" alt="pic"></p>
</li>
<li><p><strong>路由选择器</strong>。路由选择算法运行之处（后面会详细讲解路由选择算法）。</p>
</li>
</ul>
<h2 id="4-路由选择算法"><a href="#4-路由选择算法" class="headerlink" title="4. 路由选择算法"></a>4. 路由选择算法</h2><p><strong>路由选择算法</strong>，其目的是从发送方到接收方的网络中，选择一条<strong>最短路径</strong>（即网络最好最快的一条路）。</p>
<p>究其本质，就是<strong>图的最短路径</strong>问题。而解决该问题的经典算法，想必读者在数据结构或算法课上都学过，即<strong>Dijkstra</strong>、<strong>Bellman-Ford</strong>和<strong>Floyd</strong>等。</p>
<p>根据路由选择算法的差异，有不同的分类。接下来将介绍几种分类，第一种常用分类：</p>
<ul>
<li><strong>集中式路由选择算法（centralized routing algorithm）</strong>，用完整的、全局性的网络信息计算出最短路径，也常被称作<strong>链路状态（ link-state，LS）</strong>算法。</li>
<li><strong>分散式路由选择算法（decentralized routing algorithm）</strong>，以迭代、分布式的方式计算出最短路径，也常被称作<strong>距离向量（distance-vector，DV）</strong>算法。</li>
</ul>
<p>第二种广义分类：静态路由选择算法；动态路由选择算法。第三种分类：负载敏感算法；负载迟钝算法。</p>
<h3 id="4-1-链路状态路由选择算法"><a href="#4-1-链路状态路由选择算法" class="headerlink" title="4.1. 链路状态路由选择算法"></a>4.1. 链路状态路由选择算法</h3><p>链路状态路由选择算法中，网络拓扑和所有链路开销情况都是已知的，都作为 LS 算法的输入。实践中，这些信息是让每个节点向网络中其它节点广播<strong>链路状态分组</strong>来完成的，分组中包含它所连接链路的标识和开销等信息。</p>
<p>LS 算法的本质其实是大名鼎鼎的 <strong>Dijkstra 算法</strong>。在我另一篇文章 <a href="./%E5%9B%BE%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E7%AE%97%E6%B3%95.html">图的最短路径算法</a> 中，我已经详细介绍了 Dijkstra 算法的过程，在此就不再赘述了。</p>
<p>LS 算法运行过程示例如下。其中，$D(v)$ 表示到本次迭代，从源节点到 $v$ 节点的最短路径的开销；$p(v)$ 表示最短路径中 $v$ 的前一个节点：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/31.png" alt="pic"><br><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/32.png" alt="pic"></p>
<p>Dijkstra 算法的时间复杂度为 $O(n^2)$，相对较优，但也存在着一些<strong>问题</strong>：实践中，<strong>链路开销是非对称的</strong>，也就是 u 点到 v 点的开销与 v 点 u 点的开销是不相同的。同时，<strong>链路开销也是会变化的</strong>。当多个路由选择同一个时针方向时，该方向上的开销就会非常大，但反方向的开销相对较小；此时，多个路由可能同时改成反方向，而如此反方向开销剧增，正方向剧降；并进入反复横跳的循环中。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/26.png" alt="pic"></p>
<p>这种现象被称为<strong>振荡</strong>。有一种解决方法是：确保所有路由器<strong>不同时</strong>运行 LS 算法。</p>
<h3 id="4-2-距离向量路由选择算法"><a href="#4-2-距离向量路由选择算法" class="headerlink" title="4.2. 距离向量路由选择算法"></a>4.2. 距离向量路由选择算法</h3><p>DV 算法是一种迭代、分布式的算法。它的本质是 <strong>Bellman-Ford</strong> 算法，即：</p>
<p>$d(x,y) &#x3D; min{c(x,v) + d(v,y)}$<br>$v \in x所有的邻接点，c(x,v) 是 x 到 v 边的开销$</p>
<p><strong>DV 算法实际运行过程如下</strong>：</p>
<ol>
<li><p>每个节点（节点&#x3D;路由器） $x$ 需要维护一些路由信息：</p>
<ul>
<li>对于每个邻居 $v$，从 $x$ 直接到邻居 $v$ 的开销为 $c(x,v)$</li>
<li>节点 $x$ 的距离向量集，即 ${D_x(y) | y \in N}$，包含 $x$ 到 $N$ 中任意其它节点 $y$ 的最小开销估计值（最短路径）。</li>
<li>同时，会记录选择某条最短路径时的下一跳节点 $v$，即 $c(x,v) + d(v,y)$ 最小时的 $v$ 。</li>
</ul>
</li>
<li><p>每个节点还需不时地向它的每个邻居发送它的距离向量。当节点 $x$ 从它的任何一个邻居 $v$ 接收到新的距离向量时，它将保持 $v$ 的距离向量，然后使用 $d(x,y) &#x3D; min{c(x,v) + d(v,y)}$ 方程更新自己的距离向量。</p>
</li>
<li><p>如果节点 $x$ 的距离向量因步骤2而更新，那么它会向所有邻居发送它更新后的距离向量。</p>
</li>
</ol>
<p>示例如下：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/27.png" alt="pic"></p>
<p>注意在第2列中，$y$ 节点的距离向量没有更新，因此节点 $y$ 没有发送更新。</p>
<p>现在，我们需要考虑一些特殊情况：<strong>链路开销改变与链路故障</strong>。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/29.png" alt="pic"></p>
<p>当链路开销减小时：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/28.png" alt="pic"></p>
<p>当链路开销增加时：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/30.png" alt="pic"></p>
<p>从上述过程，我们可以看出：该循环将持续44次迭代（在 $y$ 与 $z$ 之间），直到 $z$ 算出它经由 $y$ 的路径开销大于50。这个问题被称为<strong>无穷计数问题</strong>。</p>
<p>一种<strong>毒性逆转</strong>的方法可用于解决该问题，但并不具有一般性。</p>
<h3 id="4-3-LS-与-DV-的比较与应用"><a href="#4-3-LS-与-DV-的比较与应用" class="headerlink" title="4.3. LS 与 DV 的比较与应用"></a>4.3. LS 与 DV 的比较与应用</h3><p>设 $N$ 是节点集，$E$ 是链路集。比较：</p>
<ul>
<li><p>传播开销。当链路开销改变时，LS 必须向所有节点广播新的链路开销，需要发送 $O(|N||E|)$；而 DV 只需向邻近节点传播。</p>
</li>
<li><p>收敛（得到正确结果）速度。LS 算法为 $O(n^2)$ ；而 DV 算法收敛较慢，且会遇到<strong>路由选择环路</strong>等问题。</p>
</li>
<li><p>健壮性。如果遇到出现故障的链路，LS 能够向所有节点广播不正常的开销；而 DV 可能把不正常的计算值扩散到整个网络。</p>
</li>
</ul>
<p>LS 算法的应用：<strong>OSPF</strong>等。</p>
<p>DV 算法的应用：<strong>RIP</strong>、<strong>BGP</strong>等。</p>
<h3 id="4-4-自治系统内部的路由选择：OSPF"><a href="#4-4-自治系统内部的路由选择：OSPF" class="headerlink" title="4.4. 自治系统内部的路由选择：OSPF"></a>4.4. 自治系统内部的路由选择：OSPF</h3><p>到目前为止的路由选择算法中，我们都将网络看作一个互联网路由器的集合，从所有路由器上执行相同的路由选择算法以计算穿过整个网络的最短路径。但是，实践中却并非如此简单，有如下原因：</p>
<ul>
<li><strong>规模</strong>。当今互联网由数亿台路由器和主机组成，在如此大的网络中运行路由选择算法，可能永远都无法收敛。而且储存网络信息将需要巨大容量。</li>
<li><strong>管理自治</strong>。第一章提到，互联网是 ISP 的网络，每个 ISP 都有自己的路由器网络，它们希望按照自己意愿运行路由器，也希望对外部<strong>隐藏</strong>其网络的内部细节。</li>
</ul>
<p>于是乎，出现了 <strong>自治系统（autonomous system, AS）</strong>。每个 AS 是一个路由器集合，并对所属路由器使用相同的方法进行管理控制。ISP 通常将他们的网络划分成一到多个 AS。而在一个 AS 中运行的路由选择算法叫作<strong>自治系统内部路由选择协议（intra-autonomous system routing protocol）</strong>。</p>
<p>自治系统内部路由选择协议有很多，如：基于 LS 算法的 OSPF 协议、基于 DV 算法的 RIP 协议等。其中，<strong>开放最短路优先 OSPF [RFC 2328]</strong> 更为常用。</p>
<p>除了拥有 LS 算法的特性，OSPF 协议还有以下优点：</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/33.png" alt="pic"></p>
<h3 id="4-5-自治系统间的路由选择：BGP"><a href="#4-5-自治系统间的路由选择：BGP" class="headerlink" title="4.5. 自治系统间的路由选择：BGP"></a>4.5. 自治系统间的路由选择：BGP</h3><p>OSPF 可以解决自治系统内部的路由问题，但当一个分组需要跨越多个 AS 时，我们则需要 <strong>自治系统间路由选择协议（inter-autonomous system routing protocol）</strong>。</p>
<p>由于 AS 间路由选择协议涉及多个 AS 之间的协调，所以 AS 间必须运行相同的协议，即 **边界网关协议 BGP [RFC 4271]**。</p>
<p>BGP 协议有如下特性：</p>
<ol>
<li><p>在 BGP 中，分组并不是路由到一个特定 IP 地址，而是路由到 CIDR 的前缀，也就是<strong>一个子网或子网的集合</strong>。所以，路由器的 BGP 路由表表项通常为 <code>(x, l)</code> 的形式，其中 <code>x</code> 是一个前缀（如138.16.68&#x2F;22），<code>l</code> 是该路由器的输出接口之一。</p>
</li>
<li><p>与 DV 算法类似，在 BGP 中，路由器会向临近路由器传递路由信息。但不同的是，<strong>BGP 路由算法并不一定选择开销最小的路径，而是会选择“最佳”的路径</strong>。</p>
</li>
</ol>
<p>在介绍 BGP 独特的路由选择算法之前，我们还需要了解一些 BGP 相关内容：</p>
<ul>
<li><p><strong>网关路由器</strong>。位于 AS 边缘，并连接到其它 AS 的路由器，被称为网关路由器。反之，则被称为内部路由器。如下图的 AS1 中，1c、1d 是网关路由器，1a、1b 则是内部路由器。</p>
</li>
<li><p><strong>BGP 属性</strong>。在 BGP 中，当路由器向临近路由器传递信息时，除了包含前缀，还包括一些 BGP 属性。其中，两个比较重要的属性是 <strong>AS-PATH</strong>（表示到达目的前缀&#x2F;子网所经过的 AS 路径，如下图中，从 <code>AS1</code> 到子网 <code>x</code> 有两条路，AS-PATH 分别是 “AS2 AS3”、“AS3”）和 <strong>NEXT-HOP</strong>（表示 AS-PATH 中第一个路由器的输入接口 IP 地址，如下图中，对于从 <code>AS1</code> 到子网 <code>x</code> 的路径 “AS2 AS3”，其 NEXT-HOP 值为路由器 2a 左边接口的 IP 地址）。</p>
</li>
<li><p><strong>BGP 路由</strong>。包含前缀及其属性的路由信息，被称为 BGP 路由。实践中，一条 BGP 路由还包括其他属性，此处我们暂时忽略。</p>
</li>
</ul>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/34.png" alt="pic"></p>
<p>接下来，将介绍 BGP 的路由选择算法。考虑的情况是：从路由器 <code>1b</code> 路由到子网 <code>x</code>，显然有两条路径：经过网关路由器 1c 到达 AS2 再到达 AS3、经过网关路由器 1d 直接到达 AS3。</p>
<ul>
<li><p><strong>热土豆路由选择算法</strong>。假设开销为经过的链路数，第一条路径的总开销肯定大于第二条路径。但根据热土豆算法，由于 1b 到 1c 的开销小于 1b 到 1d 的开销，算法会选择第一条路径。热土豆算法的思想是：尽可能地将分组送出其 AS ，而不担心送出来后的剩余开销。可以说，这是一个<strong>自私的算法</strong>。</p>
</li>
<li><p><strong>真实的 BGP 路由选择算法</strong>。如果有多条路径，则按照如下规则顺序进行筛选，直到选出最好的路径：<br><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/35.png" alt="pic"><br>由于第二条规则在第三条规则之前，所以 BGP 路由选择算法并不是一个自私的算法。<br>有关第一条规则中的 BGP 策略问题，书中也未作详细讲解，可以自行了解。</p>
</li>
</ul>
<p>除了用于 AS 间的路由选择，BGP 还常用于实现 **IP 任播 [RFC 1546, RFC 7094]**。从 BGP 路由选择算法中，我们得知：当目的地相同时，算法会从多条路径中选择“最佳”的（比如 AS-PATH 最短）。</p>
<p>BGP 任播应用：</p>
<ul>
<li><p>CDN 内容分发网络。CDN 公司会为它的多台服务器配置相同的 IP 地址，当客户访问视频等内容时，利用 BGP 路由选择算法的特点，算法会向“最近的”服务器转发请求，从而让用户得到更好的体验。但实践中 CDN 通常不使用 IP 任播，因为 BGP 路由选择算法可能会导致同一个 TCP 连接的不同分组到达不同的服务器。</p>
</li>
<li><p>DNS 系统。IP 任播被广泛地用于 DNS 系统，它会将 DNS 请求指向最近的 DNS 服务器（比如13个根服务器中的一个）。</p>
</li>
</ul>
<p>BGP 在因特网中起着重要作用，以上只是 BGP 的简要介绍。</p>
<h3 id="4-6-AS-内部和-AS-间路由选择协议的比较"><a href="#4-6-AS-内部和-AS-间路由选择协议的比较" class="headerlink" title="4.6. AS 内部和 AS 间路由选择协议的比较"></a>4.6. AS 内部和 AS 间路由选择协议的比较</h3><p><strong>AS 间路由选择是面向策略的</strong>。不同 AS 可能是由不同的 ISP 管理的，而它们之间可能是竞争关系，或者说 ISP 都是自私的，比如：一个 AS 产生的流量不能经过另一个特定的 AS 、一个 AS 并不想承载其它 AS 的流量。</p>
<p>而，<strong>AS 内部路由选择是面向性能</strong>。AS 内部是由同一个 ISP 统一管理的，所以上述策略相对不重要，而性能才是关键。</p>
<h2 id="5-软件定义网络-SDN"><a href="#5-软件定义网络-SDN" class="headerlink" title="5. 软件定义网络 SDN"></a>5. 软件定义网络 SDN</h2><p><strong>软件定义网络（Software Defined Network，SDN）</strong>，是近年来（201x）兴起的一种网络管理方法。它的提出类似于操作系统的思想，将底层网络设备进行抽象，屏蔽其具体细节，同时为上层提供相关接口。用户通过这些接口，可以开发各种软件，对网络进行集中式管理、灵活配置、自动化监控、访问控制、负载均衡等等操作。</p>
<p>书上提到，SDN 体系具有4个特征：</p>
<ul>
<li><p><strong>基于流的转发</strong>。SDN 控制的分组转发，能够基于运输层、网络层、链路层首部中的任意字段；而传统转发仅依据数据报的目的 IP 地址进行。</p>
</li>
<li><p><strong>数据平面与控制平面分离</strong>。数据平面由路由器等网络设备组成，它们会根据流表执行“匹配加动作”的规则；控制平面由服务器、以及决定和管理流表的软件组成。</p>
</li>
<li><p><strong>网络控制功能</strong>。与传统的路由器不同，算法软件在服务器上执行，服务器与网络设备截然分开并与之远离。如下图所示，控制平面由两部分组成：<strong>SDN 控制器</strong> 和 <strong>若干网络控制程序</strong>。SDN 控制器负责维护获取网络状态信息，并向上层提供；网络控制程序则以此监视、控制网络设备。</p>
<p><img src="/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E3%80%8B%E7%AC%94%E8%AE%B0-%E7%AC%AC4-5%E7%AB%A0%E7%BD%91%E7%BB%9C%E5%B1%82/36.png" alt="pic"></p>
</li>
<li><p><strong>可编程网络</strong>。通过控制平面中的网络控制应用程序，SDN 控制平面即拥有了“智力”，例如：它可以决定源与目的间的路径、可以对特定分组进行阻挡、可以根据负载均衡对分组进行转发、甚至可以运行 AI 算法。</p>
</li>
</ul>
<p>SDN 是当下的一股热潮。其中，相对突出的是 <strong>OpenFlow 协议</strong>，它运行在 SDN 控制器和网络设备上。但在此不做详细介绍。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Network/" rel="tag"><i class="fa fa-tag"></i> 计算机网络</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0%E5%B0%8F%E8%AE%B0.html" rel="prev" title="数据库复习小记">
                  <i class="fa fa-chevron-left"></i> 数据库复习小记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8-MIPS.html" rel="next" title="简单入门 MIPS">
                  简单入门 MIPS <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dounine</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">537k</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"99MyCql/99MyCql.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
